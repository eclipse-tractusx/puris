meta {
  name: 02-Create DTR Framework Policy
  type: http
  seq: 2
  tags: [
    share-enablement-services
  ]
}

post {
  url: {{CUSTOMER_EDC}}/{{MANAGEMENT_PATH}}/v3/policydefinitions
  body: json
  auth: apikey
}

auth:apikey {
  key: X-API-KEY
  value: {{CUSTOMER_EDC_API_KEY}}
  placement: header
}

body:json {
  {
    "@context" : [ "http://www.w3.org/ns/odrl.jsonld", {
      "edc" : "https://w3id.org/edc/v0.0.1/ns/",
      "cx-policy" : "https://w3id.org/catenax/policy/"
    } ],
    "@type" : "PolicyDefinitionRequestDto",
    "@id" : "{{DTR_CONTRACT_POLICY_ID}}",
    "edc:policy" : {
      "@type" : "Set",
      "profile" : "cx-policy:profile2405",
      "permission" : [ {
        "action" : "use",
        "constraint" : {
          "@type" : "LogicalConstraint",
          "and" : [ {
            "@type" : "LogicalConstraint",
            "leftOperand" : "cx-policy:FrameworkAgreement",
            "operator" : "eq",
            "rightOperand" : "DataExchangeGovernance:1.0"
          }, {
            "@type" : "LogicalConstraint",
            "leftOperand" : "cx-policy:UsagePurpose",
            "operator" : "eq",
            "rightOperand" : "cx.core.digitalTwinRegistry:1"
          } ]
        }
      } ]
    }
  }
}

tests {
  test("Status code is 200", function () {
      expect(res.getStatus()).to.equal(200);
  });
}
